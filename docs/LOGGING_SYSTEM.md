# å›¾ç§ç”Ÿæˆå™¨æ—¥å¿—ç³»ç»Ÿæ–‡æ¡£

## ğŸ‰ å®ŒæˆçŠ¶æ€

âœ… **æ—¥å¿—ç³»ç»Ÿå®Œå–„ - å·²å®Œæˆ**

æœ¬æ¬¡æ›´æ–°ä¸ºå›¾ç§ç”Ÿæˆå™¨æ·»åŠ äº†å®Œæ•´çš„æ—¥å¿—ç³»ç»Ÿï¼Œæ˜¾è‘—æå‡äº†åº”ç”¨çš„å¯ç»´æŠ¤æ€§å’Œé—®é¢˜æ’æŸ¥èƒ½åŠ›ã€‚

## ğŸš€ ä¸»è¦ç‰¹æ€§

### 1. æ ¸å¿ƒæ—¥å¿—ç³»ç»Ÿ
- **å¤šçº§åˆ«æ—¥å¿—æ”¯æŒ**
  - **DEBUG**: è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯
  - **INFO**: ä¸€èˆ¬ä¿¡æ¯è®°å½•
  - **WARN**: è­¦å‘Šä¿¡æ¯
  - **ERROR**: é”™è¯¯ä¿¡æ¯
  - **FATAL**: è‡´å‘½é”™è¯¯

### 2. çµæ´»çš„è¾“å‡ºæ–¹å¼
- **æ§åˆ¶å°è¾“å‡º**: å½©è‰²æ ¼å¼åŒ–çš„å®æ—¶æ—¥å¿—
- **æ–‡ä»¶è¾“å‡º**: æŒä¹…åŒ–æ—¥å¿—å­˜å‚¨
- **åŒé‡è¾“å‡º**: åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæ–‡ä»¶

### 3. æ™ºèƒ½æ–‡ä»¶ç®¡ç†
- **è‡ªåŠ¨è½®è½¬**: æ–‡ä»¶å¤§å°è¶…é™æ—¶è‡ªåŠ¨åˆ›å»ºæ–°æ–‡ä»¶
- **å†å²ç®¡ç†**: è‡ªåŠ¨æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶
- **ç›®å½•ç®¡ç†**: è‡ªåŠ¨åˆ›å»ºæ—¥å¿—ç›®å½•

### 4. æ€§èƒ½ä¼˜åŒ–
- **å¹¶å‘å®‰å…¨**: å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å®‰å…¨æ—¥å¿—è®°å½•
- **å†…å­˜ä¼˜åŒ–**: é«˜æ•ˆçš„ç¼“å†²åŒºç®¡ç†
- **è°ƒç”¨æ ˆè·Ÿè¸ª**: è‡ªåŠ¨è®°å½•è°ƒç”¨ä½ç½®

## ğŸ¯ æ–°å¢åŠŸèƒ½

### 1. æ ¸å¿ƒæ—¥å¿—ç³»ç»Ÿ
- **å¤šçº§åˆ«æ—¥å¿—**: DEBUG, INFO, WARN, ERROR, FATAL
- **çµæ´»è¾“å‡º**: æ§åˆ¶å° + æ–‡ä»¶åŒé‡è¾“å‡º
- **æ™ºèƒ½ç®¡ç†**: è‡ªåŠ¨æ–‡ä»¶è½®è½¬å’Œå†å²æ¸…ç†
- **æ€§èƒ½ä¼˜åŒ–**: å¹¶å‘å®‰å…¨ + è°ƒç”¨æ ˆè·Ÿè¸ª

### 2. é…ç½®ç®¡ç†é›†æˆ
- **é…ç½®æ–‡ä»¶æ”¯æŒ**: JSONæ ¼å¼çš„æ—¥å¿—é…ç½®
- **åŠ¨æ€æ›´æ–°**: è¿è¡Œæ—¶è°ƒæ•´æ—¥å¿—è®¾ç½®
- **é»˜è®¤é…ç½®**: å¼€ç®±å³ç”¨çš„åˆç†é»˜è®¤å€¼

### 3. é”™è¯¯å¤„ç†é›†æˆ
- **è‡ªåŠ¨è®°å½•**: æ‰€æœ‰é”™è¯¯è‡ªåŠ¨è®°å½•åˆ°æ—¥å¿—
- **ä¸Šä¸‹æ–‡ä¿¡æ¯**: é”™è¯¯åŒ…å«è¯¦ç»†çš„ä¸Šä¸‹æ–‡æ•°æ®
- **çº§åˆ«åˆ†ç±»**: æ ¹æ®é”™è¯¯ç±»å‹è‡ªåŠ¨é€‰æ‹©æ—¥å¿—çº§åˆ«

### 4. å‰ç«¯APIæ¥å£
- **æ—¥å¿—é…ç½®ç®¡ç†**: è·å–å’Œæ›´æ–°æ—¥å¿—é…ç½®
- **çº§åˆ«æ§åˆ¶**: åŠ¨æ€è°ƒæ•´æ—¥å¿—çº§åˆ«
- **é…ç½®æŸ¥è¯¢**: è·å–å¯ç”¨çš„æ—¥å¿—çº§åˆ«åˆ—è¡¨

## ğŸ“‹ æŠ€æœ¯å®ç°

### æ ¸å¿ƒæ–‡ä»¶ç»“æ„
```
backend/
â”œâ”€â”€ logger.go           # æ ¸å¿ƒæ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ logger_test.go      # æµ‹è¯•å’Œæ¼”ç¤º
â”œâ”€â”€ config.go          # é…ç½®ç®¡ç†(å«æ—¥å¿—é…ç½®)
â”œâ”€â”€ error_middleware.go # é”™è¯¯å¤„ç†é›†æˆ
â””â”€â”€ errors.go          # é”™è¯¯ç±»å‹å®šä¹‰
```

### ä¸»è¦ç‰¹æ€§
- **å¹¶å‘å®‰å…¨**: ä½¿ç”¨ `sync.RWMutex` ä¿æŠ¤å¹¶å‘è®¿é—®
- **å†…å­˜ä¼˜åŒ–**: é«˜æ•ˆçš„æ—¥å¿—æ ¼å¼åŒ–å’Œç¼“å†²ç®¡ç†
- **æ–‡ä»¶ç®¡ç†**: è‡ªåŠ¨åˆ›å»ºç›®å½•ã€è½®è½¬æ–‡ä»¶ã€æ¸…ç†å†å²
- **é”™è¯¯å¤„ç†**: ä¼˜é›…å¤„ç†æ—¥å¿—ç³»ç»Ÿè‡ªèº«çš„é”™è¯¯

## ğŸ“‹ é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶ç»“æ„
```json
{
  "logging": {
    "level": "info",          // æ—¥å¿—çº§åˆ«
    "enableColors": true,     // å¯ç”¨å½©è‰²è¾“å‡º
    "enableFile": true,       // å¯ç”¨æ–‡ä»¶æ—¥å¿—
    "enableConsole": true,    // å¯ç”¨æ§åˆ¶å°æ—¥å¿—
    "logDir": "logs",         // æ—¥å¿—ç›®å½•
    "maxFileSize": 10,        // æœ€å¤§æ–‡ä»¶å¤§å°(MB)
    "maxFiles": 5             // æœ€å¤§ä¿ç•™æ–‡ä»¶æ•°
  }
}
```

### é»˜è®¤é…ç½®
- **æ—¥å¿—çº§åˆ«**: INFO
- **å½©è‰²è¾“å‡º**: å¯ç”¨
- **æ–‡ä»¶æ—¥å¿—**: å¯ç”¨
- **æ§åˆ¶å°æ—¥å¿—**: å¯ç”¨
- **æ—¥å¿—ç›®å½•**: `logs/`
- **æœ€å¤§æ–‡ä»¶å¤§å°**: 10MB
- **æœ€å¤§æ–‡ä»¶æ•°**: 5ä¸ª

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨
```go
// ä½¿ç”¨å…¨å±€æ—¥å¿—å‡½æ•°
backend.Info("åº”ç”¨å¯åŠ¨æˆåŠŸ")
backend.Debug("è°ƒè¯•ä¿¡æ¯: ç”¨æˆ·ID = %d", userID)
backend.Warn("è­¦å‘Š: æ–‡ä»¶å¤§å°è¶…è¿‡å»ºè®®å€¼")
backend.Error("é”™è¯¯: æ–‡ä»¶è¯»å–å¤±è´¥ - %v", err)
```

### åˆ›å»ºè‡ªå®šä¹‰æ—¥å¿—å™¨
```go
// åˆ›å»ºé…ç½®
config := &backend.LoggerConfig{
    Level:         backend.LogLevelDebug,
    EnableColors:  true,
    EnableFile:    true,
    EnableConsole: true,
    LogDir:        "custom_logs",
    MaxFileSize:   20, // 20MB
    MaxFiles:      10,
}

// åˆ›å»ºæ—¥å¿—å™¨
logger, err := backend.NewLogger(config)
if err != nil {
    panic(err)
}
defer logger.Close()

// ä½¿ç”¨è‡ªå®šä¹‰æ—¥å¿—å™¨
logger.Info("è¿™æ˜¯è‡ªå®šä¹‰æ—¥å¿—å™¨çš„æ¶ˆæ¯")
```

### åŠ¨æ€é…ç½®æ›´æ–°
```go
// é€šè¿‡å‰ç«¯APIæ›´æ–°æ—¥å¿—é…ç½®
app.SetLogLevel("debug")
app.UpdateLoggingConfig(backend.LoggingConfig{
    Level:         "debug",
    EnableColors:  true,
    EnableFile:    true,
    EnableConsole: false,
    LogDir:        "logs",
    MaxFileSize:   50,
    MaxFiles:      3,
})
```

## ğŸ¯ é›†æˆçš„åŠŸèƒ½æ¨¡å—

### 1. é”™è¯¯å¤„ç†é›†æˆ
é”™è¯¯å¤„ç†ä¸­é—´ä»¶è‡ªåŠ¨è®°å½•æ‰€æœ‰é”™è¯¯ä¿¡æ¯ï¼š
```go
// é”™è¯¯ä¼šè‡ªåŠ¨è®°å½•åˆ°æ—¥å¿—
err := generator.ExtractFromTuzhong(path, output)
if err != nil {
    // é”™è¯¯å·²è‡ªåŠ¨è®°å½•ï¼ŒåŒ…å«ä¸Šä¸‹æ–‡ä¿¡æ¯
    return err
}
```

### 2. é…ç½®ç®¡ç†é›†æˆ
é…ç½®ç³»ç»Ÿçš„æ‰€æœ‰æ“ä½œéƒ½ä¼šè®°å½•ï¼š
```go
// é…ç½®åŠ è½½æˆåŠŸ/å¤±è´¥éƒ½ä¼šè®°å½•
err := backend.InitConfig(configPath)
// æ—¥å¿—è¾“å‡º: "Configuration loaded successfully from: /path/to/config"
```

### 3. æ–‡ä»¶æ“ä½œè·Ÿè¸ª
ä¸»è¦æ–‡ä»¶æ“ä½œéƒ½æœ‰è¯¦ç»†çš„æ—¥å¿—è®°å½•ï¼š
```go
// æ–‡ä»¶åˆå¹¶æ“ä½œ
backend.Info("Starting file merge: %s + %s -> %s", img, target, output)
// æ–‡ä»¶è¯»å–è¿›åº¦
backend.Debug("File read progress: %d%% (%d bytes)", percent, bytes)
// æ“ä½œå®Œæˆ
backend.Info("File merge completed successfully")
```

## ğŸ”§ API æ¥å£

### å‰ç«¯å¯ç”¨çš„æ—¥å¿—ç®¡ç†API

#### è·å–æ—¥å¿—é…ç½®
```javascript
const config = await window.go.main.App.GetLoggingConfig();
console.log('å½“å‰æ—¥å¿—çº§åˆ«:', config.level);
```

#### æ›´æ–°æ—¥å¿—é…ç½®
```javascript
await window.go.main.App.UpdateLoggingConfig({
    level: "debug",
    enableColors: true,
    enableFile: true,
    enableConsole: true,
    logDir: "logs",
    maxFileSize: 20,
    maxFiles: 8
});
```

#### è®¾ç½®æ—¥å¿—çº§åˆ«
```javascript
await window.go.main.App.SetLogLevel("debug");
```

#### è·å–å¯ç”¨çº§åˆ«
```javascript
const levels = await window.go.main.App.GetAvailableLogLevels();
// è¿”å›: ["debug", "info", "warn", "error", "fatal"]
```

## ğŸ“ æ—¥å¿—æ–‡ä»¶

### æ–‡ä»¶å‘½åè§„åˆ™
```
logs/
â”œâ”€â”€ tuzhong_2024-10-24_14-30-15.log  (å½“å‰æ—¥å¿—)
â”œâ”€â”€ tuzhong_2024-10-24_09-15-22.log  (å†å²æ—¥å¿—)
â””â”€â”€ tuzhong_2024-10-23_16-45-33.log  (å†å²æ—¥å¿—)
```

### æ—¥å¿—æ ¼å¼
```
[INFO] 2024-10-24 14:30:15.123 [app.go:95] Application startup completed
[DEBUG] 2024-10-24 14:30:16.456 [logic.go:127] Worker slot acquired successfully
[ERROR] 2024-10-24 14:30:17.789 [error_middleware.go:45] File read failed: permission denied
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æ—¥å¿—çº§åˆ«é€‰æ‹©
- **ç”Ÿäº§ç¯å¢ƒ**: ä½¿ç”¨ `INFO` æˆ– `WARN` çº§åˆ«
- **å¼€å‘ç¯å¢ƒ**: ä½¿ç”¨ `DEBUG` çº§åˆ«
- **æ•…éšœæ’æŸ¥**: ä¸´æ—¶è°ƒæ•´åˆ° `DEBUG` çº§åˆ«

### 2. æ¶ˆæ¯æ ¼å¼
```go
// âœ… å¥½çš„åšæ³•
backend.Info("User %s started operation %s with file %s", user, operation, file)
backend.Error("Failed to process file %s: %v", filename, err)

// âŒ é¿å…çš„åšæ³•
backend.Info("Something happened")
backend.Error("Error occurred")
```

### 3. æ€§èƒ½è€ƒè™‘
```go
// âœ… å¯¹äºå¯èƒ½æ˜‚è´µçš„æ“ä½œï¼Œå…ˆæ£€æŸ¥çº§åˆ«
if backend.GetGlobalLogger().GetLevel() <= backend.LogLevelDebug {
    expensiveDebugInfo := computeExpensiveInfo()
    backend.Debug("Expensive debug info: %s", expensiveDebugInfo)
}
```

### 4. é”™è¯¯è®°å½•
```go
// âœ… åŒ…å«è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯
backend.Error("Failed to merge files - Image: %s, Target: %s, Error: %v", 
    imagePath, targetPath, err)

// âŒ ä¿¡æ¯ä¸è¶³
backend.Error("Merge failed: %v", err)
```

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. æ—¥å¿—æ–‡ä»¶æœªåˆ›å»º
- æ£€æŸ¥æ—¥å¿—ç›®å½•æƒé™
- æ£€æŸ¥ç£ç›˜ç©ºé—´
- ç¡®è®¤ `enableFile` é…ç½®ä¸º `true`

#### 2. æ—¥å¿—çº§åˆ«ä¸ç”Ÿæ•ˆ
- ç¡®è®¤é…ç½®æ–‡ä»¶æ ¼å¼æ­£ç¡®
- é‡å¯åº”ç”¨ä»¥åº”ç”¨æ–°é…ç½®
- æ£€æŸ¥æ˜¯å¦æœ‰é…ç½®ç¼“å­˜

#### 3. æ€§èƒ½é—®é¢˜
- è°ƒæ•´æ—¥å¿—çº§åˆ«åˆ°æ›´é«˜çº§åˆ«
- å‡å°‘ `maxFiles` æ•°é‡
- å¢å¤§ `maxFileSize` ä»¥å‡å°‘è½®è½¬é¢‘ç‡

## ğŸ“ˆ ç›‘æ§å’Œç»´æŠ¤

### æ—¥å¿—ç›‘æ§
- å®šæœŸæ£€æŸ¥é”™è¯¯æ—¥å¿—æ•°é‡
- ç›‘æ§æ—¥å¿—æ–‡ä»¶å¤§å°å¢é•¿
- å…³æ³¨ç£ç›˜ç©ºé—´ä½¿ç”¨

### ç»´æŠ¤å»ºè®®
- å®šæœŸå¤‡ä»½é‡è¦æ—¥å¿—æ–‡ä»¶
- æ ¹æ®éœ€è¦è°ƒæ•´ä¿ç•™ç­–ç•¥
- ç›‘æ§åº”ç”¨æ€§èƒ½å½±å“

---

é€šè¿‡è¿™ä¸ªå®Œæ•´çš„æ—¥å¿—ç³»ç»Ÿï¼Œæ‚¨å¯ä»¥æ›´å¥½åœ°ç›‘æ§åº”ç”¨è¿è¡ŒçŠ¶æ€ã€å¿«é€Ÿå®šä½é—®é¢˜å¹¶æå‡ç”¨æˆ·ä½“éªŒã€‚